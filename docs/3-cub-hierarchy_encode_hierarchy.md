# Cub-hierarchy Encode Hierarchy

[_Documentation generated by Documatic_](https://www.documatic.com)

<!---Documatic-section-Codebase Structure-start--->
## Codebase Structure

<!---Documatic-block-system_architecture-start--->
```mermaid
None
```
<!---Documatic-block-system_architecture-end--->

# #
<!---Documatic-section-Codebase Structure-end--->

<!---Documatic-section-CUB_Hierarchy.encode_hierarchy.read_hierarchy-start--->
## CUB-Hierarchy.encode_hierarchy.read_hierarchy

<!---Documatic-section-read_hierarchy-start--->
<!---Documatic-block-CUB_Hierarchy.encode_hierarchy.read_hierarchy-start--->
<details>
	<summary><code>CUB_Hierarchy.encode_hierarchy.read_hierarchy</code> code snippet</summary>

```python
def read_hierarchy(filename):
    hierarchy = {}
    stack = []
    last_node = None
    with open(filename) as f:
        for (li, l) in enumerate(f, start=1):
            l = l.strip()
            if l != '':
                orig_node_name = l.lstrip('- ')
                node_name = orig_node_name.rstrip(' ?')
                parens_pos = node_name.find('(')
                if parens_pos > 0:
                    node_name = node_name[:parens_pos - 1]
                if node_name in hierarchy:
                    raise RuntimeError('Duplicate node name: {} (at line {})'.format(node_name, li))
                node_level = max(0, len(l) - len(orig_node_name) - 1)
                if node_level % 2 != 0:
                    raise RuntimeError('Incorrect indentation at line {}: {}'.format(li, l))
                node_level //= 2
                if node_level > len(stack) + 1:
                    raise RuntimeError('Unexpectedly deep indentation at line {}: {}'.format(li, l))
                if node_level > len(stack):
                    if last_node is None:
                        raise RuntimeError('First line must not be indented.')
                    stack.append(last_node)
                elif node_level < len(stack):
                    stack = stack[:node_level]
                hierarchy[node_name] = set()
                if len(stack) > 0:
                    hierarchy[stack[-1]].add(node_name)
                last_node = node_name
    return hierarchy
```
</details>
<!---Documatic-block-CUB_Hierarchy.encode_hierarchy.read_hierarchy-end--->
<!---Documatic-section-read_hierarchy-end--->

# #
<!---Documatic-section-CUB_Hierarchy.encode_hierarchy.read_hierarchy-end--->

<!---Documatic-section-CUB_Hierarchy.encode_hierarchy.encode_class_names-start--->
## CUB-Hierarchy.encode_hierarchy.encode_class_names

<!---Documatic-section-encode_class_names-start--->
<!---Documatic-block-CUB_Hierarchy.encode_hierarchy.encode_class_names-start--->
<details>
	<summary><code>CUB_Hierarchy.encode_hierarchy.encode_class_names</code> code snippet</summary>

```python
def encode_class_names(hierarchy, initial_labels):
    class_names = [lbl for lbl in initial_labels]
    class_ind = {lbl: i for (i, lbl) in enumerate(class_names)}
    hierarchy_names = list(hierarchy.keys())
    for name in hierarchy_names:
        if name in class_ind:
            ind = class_ind[name]
        else:
            ind = len(class_names)
            class_ind[name] = ind
            class_names.append(name)
        encoded_children = set()
        for child in hierarchy[name]:
            if child in class_ind:
                encoded_children.add(class_ind[child])
            else:
                encoded_children.add(len(class_names))
                class_ind[child] = len(class_names)
                class_names.append(child)
        hierarchy[ind] = encoded_children
        del hierarchy[name]
    return (hierarchy, class_names)
```
</details>
<!---Documatic-block-CUB_Hierarchy.encode_hierarchy.encode_class_names-end--->
<!---Documatic-section-encode_class_names-end--->

# #
<!---Documatic-section-CUB_Hierarchy.encode_hierarchy.encode_class_names-end--->

<!---Documatic-section-CUB_Hierarchy.encode_hierarchy.save_hierarchy-start--->
## CUB-Hierarchy.encode_hierarchy.save_hierarchy

<!---Documatic-section-save_hierarchy-start--->
<!---Documatic-block-CUB_Hierarchy.encode_hierarchy.save_hierarchy-start--->
<details>
	<summary><code>CUB_Hierarchy.encode_hierarchy.save_hierarchy</code> code snippet</summary>

```python
def save_hierarchy(hierarchy, filename):
    with open(filename, 'w') as f:
        for (parent, children) in hierarchy.items():
            for child in children:
                f.write('{} {}\n'.format(parent + 1, child + 1))
```
</details>
<!---Documatic-block-CUB_Hierarchy.encode_hierarchy.save_hierarchy-end--->
<!---Documatic-section-save_hierarchy-end--->

# #
<!---Documatic-section-CUB_Hierarchy.encode_hierarchy.save_hierarchy-end--->

<!---Documatic-section-CUB_Hierarchy.encode_hierarchy.plot_hierarchy-start--->
## CUB-Hierarchy.encode_hierarchy.plot_hierarchy

<!---Documatic-section-plot_hierarchy-start--->
<!---Documatic-block-CUB_Hierarchy.encode_hierarchy.plot_hierarchy-start--->
<details>
	<summary><code>CUB_Hierarchy.encode_hierarchy.plot_hierarchy</code> code snippet</summary>

```python
def plot_hierarchy(hierarchy, filename):
    import pydot
    graph = pydot.Dot(graph_type='digraph', rankdir='LR')
    nodes = {name: pydot.Node(name, style='filled', fillcolor='#ffffff' if len(children) == 0 else '#eaeaea') for (name, children) in hierarchy.items()}
    for node in nodes.values():
        graph.add_node(node)
    for (parent, children) in hierarchy.items():
        for child in children:
            graph.add_edge(pydot.Edge(nodes[parent], nodes[child]))
    graph.write_svg(filename, prog='dot')
```
</details>
<!---Documatic-block-CUB_Hierarchy.encode_hierarchy.plot_hierarchy-end--->
<!---Documatic-section-plot_hierarchy-end--->

# #
<!---Documatic-section-CUB_Hierarchy.encode_hierarchy.plot_hierarchy-end--->

[_Documentation generated by Documatic_](https://www.documatic.com)